# Playwright Automation Script Generator

## Input: $ARGUMENTS (Optional)
**Accepts:** Test workflow file path | Context/Test directory scan | Specific workflow name | Empty (auto-detect)

**Default Behavior:** If no arguments provided, automatically scan `Context/Test/` directory for workflow files generated by `/generate-automation-test` command and process the most recent ones.

**Integration:** This command is designed to consume the output from `/generate-automation-test` command. The typical workflow is:
1. `/generate-automation-test Context/requirements.md` → Creates workflow files in Context/Test/
2. `/generate-playwright-scripts` → Automatically processes those workflow files → Creates Playwright scripts in test-automation/

As a Senior Test Automation Engineer expert in Playwright and JavaScript/TypeScript, generate comprehensive Playwright automation scripts based on test workflow specifications created by the automation test workflow generator.

## Core Execution Principles

*** MANDATORY VALIDATIONS ***
- Test workflow analysis and understanding is required before script generation
- **Auto-Discovery**: If no arguments provided, scan Context/Test/ directory for workflow files
- **File Validation**: Ensure workflow files exist and are properly formatted from generate-automation-test output
- **Sequential Processing**: Process workflow files in creation order (oldest to newest)
- Generate production-ready Playwright scripts with proper error handling
- Request explicit user confirmation (YES/NO) before creating script files
- Create maintainable, scalable automation scripts following best practices
- Ensure all scripts are executable and include proper wait strategies
- Generate complete test suite with proper configuration

## Workflow Integration Strategy

### 1. Auto-Discovery Mode (Recommended)
When called without arguments, the command will:
- Scan `Context/Test/` directory for all `test_workflow_*.md` files
- Parse metadata to identify source requirements and creation timestamps
- Process workflows in logical dependency order
- Generate comprehensive test suite covering all identified workflows

### 2. Selective Processing Mode
When called with specific arguments:
- **File Path**: Process specific workflow file (e.g., `Context/Test/test_workflow_login.md`)
- **Directory Scan**: Process all workflows in Context/Test/ directory
- **Workflow Name**: Find and process workflow by name pattern matching

## Script Generation Strategy

This command consumes test workflow specifications from `Context/Test/` directory and generates executable Playwright automation scripts in the `test-automation/` directory structure.

### 1. Workflow Analysis
- **Workflow Parsing**: Parse test workflow YAML specifications into actionable steps
- **Step Translation**: Convert workflow steps into Playwright actions and assertions
- **Selector Extraction**: Extract and validate CSS selectors and element identifiers
- **Test Data Integration**: Integrate test data requirements into script structure
- **Validation Point Mapping**: Convert validation criteria into Playwright assertions

### 2. Script Architecture Design
- **Page Object Implementation**: Generate page object classes based on workflow specifications
- **Test File Organization**: Create organized test files by feature or user journey
- **Configuration Setup**: Generate Playwright configuration with specified browser and execution settings
- **Utility Function Creation**: Create reusable helper functions for common operations
- **Data Management**: Implement test data loading and management utilities

### 3. Quality and Maintainability
- **Error Handling**: Implement robust error handling and retry strategies
- **Wait Strategies**: Use appropriate wait conditions for stable test execution
- **Reporting Integration**: Include screenshot, video, and detailed reporting capabilities
- **Cross-Browser Support**: Ensure scripts work across specified browsers
- **Performance Optimization**: Implement efficient test execution patterns

## Essential Project Intelligence

### Test Workflow Analysis
- **Workflow Specifications**: Read test workflow files from Context/Test directory
- **Automation Testing Gotchas**: **MANDATORY** follow `References/Gotchas/automation_testing_gotchas.md` for best practices
- **Technical Requirements**: Extract browser, viewport, and execution requirements
- **Test Data Needs**: Understand data requirements and management strategy
- **Assertion Strategies**: Implement functional, visual, and performance validations

*** Test workflow comprehension AND strict adherence to automation best practices are essential for accurate script generation ***

### Critical Script Generation Principles
**⚠️ MANDATORY COMPLIANCE**: All generated scripts MUST implement these patterns from automation_testing_gotchas.md:

1. **Stable Selectors**: Implement role-based locators (getByRole) as primary choice
2. **Proper Wait Strategies**: Use web-first assertions and waitForSelector, NEVER waitForTimeout
3. **Test Isolation**: Each test must handle its own setup and cleanup
4. **Page Object Pattern**: Clean separation of test logic and page interactions
5. **Error Resilience**: Comprehensive error handling and retry strategies
6. **Network Mocking**: Mock external APIs instead of relying on live services

## Script Generation Framework

### Page Object Pattern Implementation
**⚠️ CRITICAL**: Generate page objects following automation_testing_gotchas.md patterns:

```typescript
export class [PageName]Page {
  constructor(page: Page) {
    this.page = page;
  }

  // ✅ GOOD: Role-based and semantic locators
  get submitButton() {
    return this.page.getByRole('button', { name: 'Submit' });
  }

  get emailInput() {
    return this.page.getByLabel('Email address');
  }

  get errorAlert() {
    return this.page.getByRole('alert');
  }

  // ✅ GOOD: Test-id fallback for custom components
  get customWidget() {
    return this.page.getByTestId('custom-widget');
  }

  // Actions with proper wait strategies
  async login(email: string, password: string) {
    await this.page.getByLabel('Email').fill(email);
    await this.page.getByLabel('Password').fill(password);
    await this.submitButton.click();
    
    // ✅ GOOD: Web-first assertion instead of arbitrary wait
    await expect(this.page.getByText('Welcome')).toBeVisible();
  }

  // Validations using web-first assertions
  async verifyLoginSuccess() {
    await expect(this.page.getByText('Dashboard')).toBeVisible();
    await expect(this.page).toHaveURL(/\/dashboard/);
  }

  // ❌ NEVER include these anti-patterns:
  // await this.page.waitForTimeout(2000); // Hard-coded wait
  // this.page.locator('div:nth-child(3)'); // Fragile selector
  // expect(await this.isLoggedIn()).toBe(true); // Test logic in page object
}
```

### Test File Structure
**⚠️ CRITICAL**: Generate test files following isolation principles from automation_testing_gotchas.md:

```typescript
import { test, expect } from '@playwright/test';
import { LoginPage } from '../pages/login.page';

test.describe('User Authentication', () => {
  // ✅ GOOD: Each test is completely isolated
  test.beforeEach(async ({ page }) => {
    await page.goto('/login');
    // Fresh state for each test
  });

  test('should login with valid credentials', async ({ page }) => {
    const loginPage = new LoginPage(page);
    
    // ✅ GOOD: Descriptive test name explaining workflow
    await loginPage.login('user@example.com', 'ValidPass123!');
    
    // ✅ GOOD: Web-first assertions with proper waits
    await expect(page.getByText('Welcome back')).toBeVisible();
    await expect(page).toHaveURL(/\/dashboard/);
  });

  test('should show error for invalid credentials', async ({ page }) => {
    const loginPage = new LoginPage(page);
    
    await loginPage.login('invalid@example.com', 'wrongpass');
    
    // ✅ GOOD: Test error scenarios thoroughly
    await expect(page.getByRole('alert')).toHaveText('Invalid credentials');
    await expect(page).toHaveURL('/login'); // Should stay on login page
  });

  // ✅ GOOD: Test isolation - cleanup if needed
  test.afterEach(async ({ page }) => {
    // Clear session state only if necessary
    await page.evaluate(() => {
      localStorage.clear();
      sessionStorage.clear();
    });
  });

  // ❌ NEVER do these:
  // test('test1', ...) // Vague test names
  // Rely on previous test's state
  // Use waitForTimeout anywhere
  // Test implementation details instead of user behavior
});
```

### Configuration Generation
Create comprehensive Playwright configuration:

```typescript
import { defineConfig } from '@playwright/test';

export default defineConfig({
  // Configuration based on workflow specifications
});
```

## Context Documentation Requirements

### Essential Script Generation Context
- **Workflow Specifications**: Complete test workflow with all steps and validations
- **Technical Requirements**: Browser, viewport, and execution configuration
- **Test Data**: Required data sets and management approach
- **Application Context**: URLs, authentication, and setup requirements

## Output Specifications

**Directory Structure**:
```
test-automation/
├── tests/
│   ├── [feature-name].spec.ts
│   └── [workflow-name].spec.ts
├── pages/
│   ├── [page-name].page.ts
│   └── base.page.ts
├── data/
│   ├── [test-data].json
│   └── test-users.json
├── utils/
│   ├── helpers.ts
│   └── test-setup.ts
├── playwright.config.ts
└── package.json
```

**File Naming Conventions**:
- Test Files: `[feature-name].spec.ts`
- Page Objects: `[page-name].page.ts`
- Test Data: `[data-set].json`
- Utilities: `[function-group].ts`

## Quality Assurance Framework

### Generated Script Requirements
- [ ] **Executable**: All scripts run without errors in specified environments
- [ ] **Stable**: Proper wait strategies and error handling implemented
- [ ] **Maintainable**: Clean code structure with proper abstractions
- [ ] **Comprehensive**: Full coverage of workflow scenarios including edge cases
- [ ] **Configurable**: Easy configuration for different environments
- [ ] **Reportable**: Proper reporting and debugging capabilities
- [ ] **Cross-Browser**: Support for all specified browsers
- [ ] **Performance**: Optimized execution with parallel capabilities

### Code Quality Standards
- **TypeScript**: Use TypeScript for type safety and better IDE support
- **ESLint/Prettier**: Follow consistent code formatting and linting rules
- **Error Handling**: Comprehensive error handling with meaningful messages
- **Documentation**: Inline comments for complex logic and setup requirements
- **Test Organization**: Logical grouping and naming of tests and utilities

## Comprehensive Script Evaluation Protocol

### Quality Metrics Assessment

| **Evaluation Dimension** | **Assessment Criteria** |
|---------------------------|-------------------------|
| **Functionality** | Scripts execute all workflow steps correctly |
| **Stability** | Consistent execution without flaky failures |
| **Maintainability** | Clean code structure and proper abstractions |
| **Performance** | Efficient execution with appropriate parallelization |
| **Error Handling** | Robust error handling and recovery strategies |
| **Reporting** | Comprehensive test results and debugging information |
| **Cross-Browser** | Consistent behavior across specified browsers |
| **Documentation** | Clear documentation and code comments |

## Input Type Handling

This command processes workflow files generated by `/generate-automation-test`:

### 🤖 Auto-Discovery Mode (Default - No Arguments)
- **Trigger**: `/generate-playwright-scripts` (no arguments)
- **Source**: Automatically scans `Context/Test/` directory for all `test_workflow_*.md` files
- **Processing**: Generates scripts for all discovered workflow files in dependency order
- **Output**: Complete test automation suite covering all test workflows
- **Best For**: Processing all workflows after running `/generate-automation-test Context/requirements.md`

### 📁 Directory Scan Mode
- **Trigger**: `/generate-playwright-scripts Context/Test/`
- **Source**: `Context/Test/` directory containing test workflow files
- **Processing**: Generate scripts for all workflow files in specified directory
- **Output**: Complete test automation suite
- **Best For**: Explicit directory processing or custom Context locations

### 📄 Specific Workflow File Mode
- **Trigger**: `/generate-playwright-scripts Context/Test/test_workflow_login_20241201.md`
- **Source**: Path to specific test workflow file from generate-automation-test output
- **Processing**: Generate scripts for the specified workflow only
- **Output**: Targeted automation scripts for single workflow
- **Best For**: Processing individual workflows or debugging specific test scenarios

### 🔍 Workflow Name Mode  
- **Trigger**: `/generate-playwright-scripts "ESG Dashboard Login"`
- **Source**: Searches Context/Test/ for workflow matching the name pattern
- **Processing**: Find and process workflow file by name/title matching
- **Output**: Scripts for named workflow specification
- **Best For**: Processing workflows by feature name when multiple workflows exist

## Integration Requirements

### Playwright/MCP Tools Integration
- **MCP Compatibility**: Ensure generated scripts work with Playwright MCP tools
- **Tool Integration**: Support for browser automation and testing capabilities
- **Execution Environment**: Compatible with local and CI/CD execution environments

### Dependencies Management
Generate appropriate package.json with required dependencies:

```json
{
  "devDependencies": {
    "@playwright/test": "^1.40.0",
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0"
  },
  "scripts": {
    "test": "playwright test",
    "test:headed": "playwright test --headed",
    "test:debug": "playwright test --debug",
    "test:report": "playwright show-report"
  }
}
```

## Execution and Validation

### Script Validation Process
1. **Syntax Validation**: Ensure generated TypeScript compiles without errors
2. **Configuration Validation**: Verify Playwright configuration is valid
3. **Dependency Check**: Ensure all required dependencies are included
4. **Test Execution**: Validate scripts can be executed in target environment

### Performance Optimization
- **Parallel Execution**: Configure appropriate worker count for parallel test execution
- **Resource Management**: Optimize browser lifecycle and resource usage
- **Test Isolation**: Ensure proper test isolation and cleanup
- **Selective Execution**: Support for running specific tests or test groups

---

*This Playwright automation script generator creates production-ready, maintainable automation scripts that execute the test workflows defined in the automation test workflow specifications, completing the end-to-end automation pipeline from requirements to executable tests.*